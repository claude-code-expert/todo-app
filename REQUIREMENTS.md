# Tika - 요구사항 명세 (REQUIREMENTS.md)

> Claude Code 참조용 상세 요구사항.
> PRD, TRD와 함께 CLAUDE.md에서 참조한다.
> 버전: 1.1 (MVP)
> 최종 수정일: 2026-02-01

---

## 1. 기능 요구사항 (Functional Requirements)

### FR-001: 티켓 생성

**설명**: 사용자가 새로운 티켓(할 일)을 생성하여 Backlog 칼럼에 추가한다.

**입력 필드**:

| 필드 | 타입 | 필수 | 제약조건 | 기본값 |
|------|------|------|----------|--------|
| title | string | O | 1~200자, 공백만으로 구성 불가 | — |
| description | string | X | 최대 1,000자 | null |
| priority | enum | X | LOW, MEDIUM, HIGH 중 택 1 | MEDIUM |
| dueDate | date (ISO 8601) | X | 오늘 이후 날짜만 허용 | null |

**처리 규칙**:
- 생성 시 status는 항상 `BACKLOG`
- 생성 시 position은 해당 칼럼의 최솟값 - 1024 (맨 위 배치)
- 칼럼에 티켓이 없을 경우 position = 0
- createdAt, updatedAt 서버에서 자동 설정 (UTC)

**API**: `POST /api/tickets`
**성공 응답**: 201 Created + 생성된 티켓 전체 데이터
**실패 응답**: 400 Bad Request + 검증 에러 상세

**검증 에러 메시지**:
- 제목 누락: `"제목을 입력해주세요"`
- 제목 200자 초과: `"제목은 200자 이내로 입력해주세요"`
- 설명 1,000자 초과: `"설명은 1,000자 이내로 입력해주세요"`
- 잘못된 우선순위: `"우선순위는 LOW, MEDIUM, HIGH 중 선택해주세요"`
- 과거 마감일: `"마감일은 오늘 이후 날짜를 선택해주세요"`

---

### FR-002: 티켓 목록 조회 (보드 뷰)

**설명**: 칸반 보드에 표시할 전체 티켓을 4개 칼럼별로 그룹화하여 조회한다.

**응답 데이터 구조**:
```json
{
  "board": {
    "BACKLOG": [ /* Ticket[] - position 오름차순 */ ],
    "TODO": [ /* Ticket[] */ ],
    "IN_PROGRESS": [ /* Ticket[] */ ],
    "DONE": [ /* Ticket[] */ ]
  },
  "total": 9
}
```

**처리 규칙**:
- 각 칼럼 내 정렬: position 오름차순
- 각 티켓에 `isOverdue` 파생 필드 포함 (DB 저장 안 함, 조회 시 계산)
- 칼럼 키 순서: BACKLOG → TODO → IN_PROGRESS → DONE (고정)

**카드 표시 정보**: 제목(1줄 말줄임), 우선순위 뱃지, 마감일, 오버듀 표시

**API**: `GET /api/tickets`
**성공 응답**: 200 OK

---

### FR-003: 티켓 상세 조회

**설명**: 특정 티켓의 전체 정보를 조회한다. 카드 클릭 시 상세 모달에 표시.

**입력**: 티켓 ID (path parameter, 양의 정수)

**모달 표시 정보**:
- 제목, 설명 (전문)
- 현재 상태(칼럼명), 우선순위
- 마감일, 생성일, 수정일
- 완료일 (Done 상태인 경우)
- 오버듀 여부
- 수정 / 삭제 버튼

**API**: `GET /api/tickets/:id`
**성공 응답**: 200 OK + 티켓 전체 데이터 (isOverdue 포함)
**실패 응답**: 404 Not Found (`TICKET_NOT_FOUND`)

---

### FR-004: 티켓 수정

**설명**: 상세 모달에서 티켓의 제목, 설명, 우선순위, 마감일을 수정한다. 부분 업데이트(PATCH) 방식.

**수정 가능 필드**:

| 필드 | 타입 | 제약조건 | 특이사항 |
|------|------|----------|----------|
| title | string | 1~200자 | 공백만 불가 |
| description | string \| null | 최대 1,000자 | null 전송 시 기존 설명 삭제 |
| priority | enum | LOW, MEDIUM, HIGH | — |
| dueDate | string \| null | YYYY-MM-DD, 오늘 이후 | null 전송 시 기존 마감일 삭제 |

**처리 규칙**:
- 부분 수정(PATCH): 전송된 필드만 업데이트, 나머지 유지
- null과 undefined 구분: null = "해당 값을 지운다", 필드 미전송 = "해당 값을 건드리지 않는다"
- updatedAt 자동 갱신

**API**: `PATCH /api/tickets/:id`
**성공 응답**: 200 OK + 수정된 티켓 전체 데이터
**실패 응답**: 400 (검증 실패), 404 (`TICKET_NOT_FOUND`)

---

### FR-005: 티켓 삭제

**설명**: 상세 모달에서 티켓을 삭제한다. 삭제 전 확인 다이얼로그 표시.

**입력**: 티켓 ID (path parameter)

**처리 규칙**:
- 하드 삭제 (Hard Delete): DB에서 완전히 제거 (MVP — soft delete 미적용)
- 프론트엔드에서 삭제 전 확인 다이얼로그 필수 표시

**API**: `DELETE /api/tickets/:id`
**성공 응답**: 204 No Content (응답 본문 없음)
**실패 응답**: 404 Not Found (`TICKET_NOT_FOUND`)

---

### FR-006: 티켓 상태 이동 (드래그앤드롭)

**설명**: 카드를 드래그앤드롭하여 다른 칼럼으로 이동하거나, 같은 칼럼 내에서 순서를 변경한다.

**입력**:

| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| ticketId | number | O | 이동할 티켓 ID |
| status | enum | O | 대상 칼럼 (BACKLOG, TODO, IN_PROGRESS, DONE) |
| position | number | O | 대상 칼럼 내 새 위치 인덱스 (0부터 시작) |

**처리 규칙**:
- 상태(status)와 순서(position) 동시 업데이트
- 대상 칼럼 내 다른 티켓들의 position 재정렬
- 트랜잭션으로 원자성 보장
- 이동 제약 없음: 어떤 칼럼에서든 어떤 칼럼으로든 자유 이동 가능

**비즈니스 로직**:
- DONE으로 이동 시: `completedAt = NOW()` 자동 설정
- DONE에서 다른 칼럼으로 이동 시: `completedAt = null` 초기화

**낙관적 업데이트(Optimistic Update)**:
1. 사용자가 카드를 드롭하는 즉시 UI 반영
2. 백그라운드에서 API 호출
3. API 성공 시: 확정
4. API 실패 시: 드래그 시작 시점의 보드 상태로 롤백

**position 계산 전략**:
- 초기 간격: 1024
- 삽입 시: 양쪽 position의 중간값 (midpoint)
- 간격 소진 시: 해당 칼럼 전체 position을 1024 간격으로 재배치

**API**: `PATCH /api/tickets/reorder`
**성공 응답**: 200 OK + 업데이트된 티켓 + 영향받은 티켓 목록
**실패 응답**: 400 (잘못된 status), 404 (`TICKET_NOT_FOUND`)

---

### FR-007: 오버듀 판정

**설명**: 마감일이 지났으나 완료되지 않은 티켓에 시각적 경고를 표시한다.

**판정 규칙**:
```
isOverdue = (dueDate != null) AND (dueDate < 오늘 날짜) AND (status ≠ DONE)
```

**예외 처리**:
- 마감일 미설정 → isOverdue = false
- Done 상태 → 마감일 지나도 isOverdue = false
- 마감일이 오늘 → isOverdue = false (초과한 경우만 해당)

**구현 방식**:
- DB에 저장하지 않음 — 조회 시점에 서버/클라이언트에서 계산 (파생 필드)

**시각적 표현**:
- 카드: 빨간 테두리 + 마감일 옆 경고 아이콘(⚠)
- 모달: "마감 초과" 텍스트 표시

---

### 기능 요구사항 요약

| ID | 기능 | 설명 | API 엔드포인트 |
|----|------|------|---------------|
| FR-001 | 티켓 생성 | 새 티켓을 만들어 Backlog에 추가 | `POST /api/tickets` |
| FR-002 | 보드 조회 | 칼럼별 그룹화된 전체 티켓 조회 | `GET /api/tickets` |
| FR-003 | 상세 조회 | 특정 티켓 전체 정보 + isOverdue | `GET /api/tickets/:id` |
| FR-004 | 티켓 수정 | 제목/설명/우선순위/마감일 부분 수정 | `PATCH /api/tickets/:id` |
| FR-005 | 티켓 삭제 | 확인 후 영구 삭제 | `DELETE /api/tickets/:id` |
| FR-006 | 상태 이동 | 드래그앤드롭으로 칼럼/순서 변경 | `PATCH /api/tickets/reorder` |
| FR-007 | 오버듀 판정 | 마감 초과 티켓에 경고 표시 | 조회 시 파생 필드 |

---

## 2. 비기능 요구사항 (Non-Functional Requirements)

### NFR-001: 성능

| 항목 | 기준 | 측정 방법 |
|------|------|----------|
| API 응답 시간 | p95 기준 200ms 이하 | 서버 사이드 로깅 |
| 보드 초기 로드 | 2초 이내 (FCP) | Lighthouse |
| 드래그 반응 | 체감 지연 없음 | 낙관적 업데이트로 보장 |

**근거**: Next.js Server Component → 서버에서 DB 직접 조회 + HTML 렌더링 → 클라이언트 왕복 1회

---

### NFR-002: 반응형 디자인

| 디바이스 | 화면 너비 | 레이아웃 | 드래그 방식 |
|----------|----------|---------|------------|
| 모바일 | 360px 이상 | 단일 칼럼 세로 스크롤 | 터치 드래그 (200ms 딜레이) |
| 태블릿 | 768px 이상 | 2칼럼 그리드 | 터치 드래그 |
| 데스크톱 | 1024px 이상 | 4칼럼 가로 배치 | 마우스 드래그 |

**구현**: Tailwind CSS 반응형 접두사
```css
grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4
```

---

### NFR-003: 접근성 (Accessibility)

| 항목 | 기준 |
|------|------|
| 키보드 네비게이션 | Tab으로 카드 이동, Enter로 상세 열기, ESC로 모달 닫기 |
| 스크린 리더 | 모든 대화형 요소에 `role`, `aria-label` 속성 적용 |
| 색상 대비 | WCAG 2.1 AA 기준 충족 |

**카드 접근성 예시**:
```html
<div role="button" aria-label="티켓: API 설계 문서 작성" tabindex="0">
```

---

### NFR-004: 데이터 무결성

| 항목 | 전략 |
|------|------|
| 낙관적 업데이트 | UI 즉시 반영 → API 성공 시 확정, 실패 시 롤백 |
| position 충돌 방지 | 정수 간격(1024) + 간격 소진 시 전체 재정렬 |
| 입력 검증 | 프론트엔드(UX) + 백엔드(신뢰 경계) 이중 검증 |

**이중 검증 정책**:
- 프론트엔드: 사용자에게 즉각적 피드백 제공 (Zod 스키마)
- 백엔드: 서버에서 동일한 Zod 스키마로 재검증 (보안)
- 클라이언트 검증을 우회한 직접 API 호출도 서버에서 차단

---

### NFR-005: 브라우저 호환성

| 브라우저 | 지원 범위 |
|----------|----------|
| Chrome | 최신 2개 버전 |
| Safari | 최신 2개 버전 |
| Firefox | 최신 2개 버전 |
| Edge | 최신 2개 버전 |
| IE | **미지원** |

**근거**: Next.js 15 기본 빌드 타겟이 모던 브라우저. 별도 폴리필 불필요.

---

### NFR-006: 배포 환경

| 항목 | 선택 | 비고 |
|------|------|------|
| 호스팅 | Vercel | Next.js 최적 배포, Git push 자동 배포 |
| 데이터베이스 | Vercel Postgres (Neon) | 서버리스 최적화, Drizzle ORM 연동 |
| HTTPS | Vercel 기본 제공 | 별도 인증서 설정 불필요 |
| 도메인 | Vercel 서브도메인 | MVP 단계 (커스텀 도메인 2차) |
| 프리뷰 배포 | PR별 자동 생성 | 코드 리뷰 + 동작 확인 동시 수행 |

---

### 비기능 요구사항 요약

| ID | 항목 | 핵심 기준 |
|----|------|----------|
| NFR-001 | 성능 | API p95 200ms 이하, 보드 로드 2초 이내 |
| NFR-002 | 반응형 | 모바일(360px) ~ 데스크톱(1920px), 3단계 레이아웃 |
| NFR-003 | 접근성 | 키보드 네비게이션, 스크린 리더, WCAG 2.1 AA |
| NFR-004 | 데이터 무결성 | 낙관적 업데이트 + 롤백, Zod 이중 검증 |
| NFR-005 | 브라우저 호환 | Chrome/Safari/Firefox/Edge 최신 2버전 |
| NFR-006 | 배포 | Vercel + Vercel Postgres, HTTPS, 자동 배포 |

---

## 3. 사용자 스토리 (User Stories)

> 형식: **[역할]로서, [행동]을 할 수 있다. 그래서 [가치/목적]을 달성한다.**
> 각 스토리에 인수 조건(Acceptance Criteria)을 포함한다.

### US-001: 새 할 일 등록

> **사용자**로서, 떠오른 할 일을 빠르게 등록할 수 있다. 그래서 **아이디어가 떠오르는 즉시 기록하여 잊어버리지 않는다.**

**인수 조건**:
- [ ] 보드 상단의 "+ 새 티켓" 버튼을 누르면 생성 모달이 열린다
- [ ] 제목을 입력하고 "생성" 버튼을 누르면 Backlog 칼럼 맨 위에 카드가 추가된다
- [ ] 제목만 입력하면 바로 생성 가능 (나머지 필드는 선택)
- [ ] 빈 제목으로 생성 시도 시 "제목을 입력해주세요" 에러 표시
- [ ] 생성 완료 시 모달이 닫히고 보드에 새 카드가 즉시 나타난다

**관련 FR**: FR-001

---

### US-002: 할 일의 상세 정보 설정

> **사용자**로서, 할 일에 우선순위와 마감일을 설정할 수 있다. 그래서 **여러 할 일 중 어떤 것을 먼저 처리해야 하는지 판단하고 일정을 관리한다.**

**인수 조건**:
- [ ] 생성 시 우선순위를 Low / Medium / High 중 선택할 수 있다
- [ ] 선택하지 않으면 Medium으로 자동 설정된다
- [ ] 마감일을 날짜 입력 필드에서 선택할 수 있다
- [ ] 오늘 이전 날짜는 선택할 수 없다
- [ ] 설명란에 최대 1,000자까지 상세 내용을 입력할 수 있다

**관련 FR**: FR-001

---

### US-003: 칸반 보드로 현황 파악

> **사용자**로서, 모든 할 일을 상태별로 분류된 칸반 보드에서 볼 수 있다. 그래서 **어떤 일이 대기 중이고, 진행 중이고, 완료되었는지 한눈에 파악한다.**

**인수 조건**:
- [ ] 페이지를 열면 4개 칼럼(Backlog, TODO, In Progress, Done)이 표시된다
- [ ] 각 칼럼에 해당 상태의 티켓이 카드 형태로 나열된다
- [ ] 각 칼럼 상단에 해당 칼럼의 카드 수가 뱃지로 표시된다
- [ ] 카드에는 제목, 우선순위 뱃지, 마감일이 표시된다
- [ ] 데스크톱에서 4칼럼, 태블릿에서 2칼럼, 모바일에서 1칼럼으로 표시된다

**관련 FR**: FR-002

---

### US-004: 마감 초과 할 일 인지

> **사용자**로서, 마감일이 지난 미완료 할 일을 시각적으로 구분할 수 있다. 그래서 **긴급하게 처리해야 할 작업을 놓치지 않는다.**

**인수 조건**:
- [ ] 마감일이 지났고 Done이 아닌 카드에 빨간 테두리가 표시된다
- [ ] 마감일 옆에 경고 아이콘(⚠)이 표시된다
- [ ] Done 칼럼의 카드는 마감일이 지나도 경고가 표시되지 않는다
- [ ] 마감일이 오늘인 카드에는 경고가 표시되지 않는다 (초과한 경우만)

**관련 FR**: FR-007

---

### US-005: 드래그앤드롭으로 상태 변경

> **사용자**로서, 카드를 드래그하여 다른 칼럼으로 옮길 수 있다. 그래서 **마우스(또는 터치) 한 동작으로 직관적이고 빠르게 할 일의 상태를 변경한다.**

**인수 조건**:
- [ ] 카드를 클릭한 채로 끌면 드래그가 시작된다
- [ ] 다른 칼럼 위에 놓으면 해당 칼럼으로 이동한다
- [ ] 같은 칼럼 내에서 드래그하면 순서가 변경된다
- [ ] 이동 즉시 UI에 반영된다 (API 응답을 기다리지 않음)
- [ ] 서버 통신 실패 시 카드가 원래 위치로 되돌아간다
- [ ] 어떤 칼럼에서든 어떤 칼럼으로든 자유롭게 이동 가능하다
- [ ] 모바일에서는 길게 터치(200ms) 후 드래그할 수 있다

**관련 FR**: FR-006

---

### US-006: 할 일 완료 처리

> **사용자**로서, 카드를 Done 칼럼으로 이동하여 할 일을 완료 처리할 수 있다. 그래서 **완료된 작업을 기록하고, 남은 작업에 집중한다.**

**인수 조건**:
- [ ] 카드를 Done 칼럼으로 드래그하면 완료로 처리된다
- [ ] 완료 처리 시 완료 시각(completedAt)이 자동 기록된다
- [ ] Done에서 다른 칼럼으로 되돌리면 완료가 취소된다 (completedAt = null)
- [ ] 완료 취소 후 마감일이 지났다면 오버듀로 표시된다

**관련 FR**: FR-006

---

### US-007: 할 일 내용 수정

> **사용자**로서, 기존 할 일의 제목이나 세부 정보를 수정할 수 있다. 그래서 **상황이 변했을 때 할 일의 내용을 최신 상태로 유지한다.**

**인수 조건**:
- [ ] 카드를 클릭하면 상세 모달이 열린다
- [ ] 모달에서 "수정" 버튼을 누르면 편집 모드로 전환된다
- [ ] 제목, 설명, 우선순위, 마감일을 수정할 수 있다
- [ ] 설명이나 마감일을 비우면 해당 정보가 삭제된다 (null 처리)
- [ ] "저장" 버튼을 누르면 변경 사항이 반영된다
- [ ] 모달 외부를 클릭하거나 ESC 키를 누르면 모달이 닫힌다

**관련 FR**: FR-003, FR-004

---

### US-008: 할 일 삭제

> **사용자**로서, 더 이상 필요 없는 할 일을 삭제할 수 있다. 그래서 **보드를 깔끔하게 유지하고 불필요한 작업에 시선을 빼앗기지 않는다.**

**인수 조건**:
- [ ] 상세 모달에서 "삭제" 버튼을 누른다
- [ ] "정말 삭제하시겠습니까?" 확인 다이얼로그가 표시된다
- [ ] "삭제"를 누르면 티켓이 영구 삭제되고 보드에서 사라진다
- [ ] "취소"를 누르면 삭제가 취소되고 모달로 돌아간다

**관련 FR**: FR-005

---

### 사용자 스토리 ↔ 기능 요구사항 ↔ 테스트 케이스 매핑

| 사용자 스토리 | 관련 FR | 관련 테스트 케이스 |
|--------------|---------|------------------|
| US-001: 새 할 일 등록 | FR-001 | TC-API-001, TC-COMP-004 |
| US-002: 상세 정보 설정 | FR-001 | TC-API-001 |
| US-003: 칸반 보드 현황 파악 | FR-002 | TC-API-002, TC-COMP-002, TC-COMP-003 |
| US-004: 마감 초과 할 일 인지 | FR-007 | TC-API-002 (002-4, 002-5), TC-COMP-001 (C001-2) |
| US-005: 드래그앤드롭 상태 변경 | FR-006 | TC-API-006, TC-INT-001 |
| US-006: 할 일 완료 처리 | FR-006 | TC-API-006 (006-3, 006-4), TC-INT-001 (I001-3) |
| US-007: 할 일 내용 수정 | FR-003, FR-004 | TC-API-003, TC-API-004, TC-COMP-005 |
| US-008: 할 일 삭제 | FR-005 | TC-API-005, TC-COMP-005 (C005-4), TC-COMP-006 |

---

## 4. 공통 정의

### 칼럼(상태) 정의

```typescript
const TICKET_STATUS = {
  BACKLOG: 'BACKLOG',
  TODO: 'TODO',
  IN_PROGRESS: 'IN_PROGRESS',
  DONE: 'DONE',
} as const;

type TicketStatus = typeof TICKET_STATUS[keyof typeof TICKET_STATUS];
```

- **칼럼 순서**: BACKLOG → TODO → IN_PROGRESS → DONE (고정, 변경 불가)
- **이동 제약**: 없음 (어떤 칼럼에서든 어떤 칼럼으로든 이동 가능)
- **칼럼 설명**:
  - BACKLOG: 등록만 된 상태. 아직 일정이 잡히지 않은 할 일
  - TODO: 할 일로 확정. 오늘 또는 이번 주 내 처리 예정
  - IN_PROGRESS: 현재 진행 중인 작업
  - DONE: 완료된 작업

### 우선순위 정의

```typescript
const TICKET_PRIORITY = {
  LOW: 'LOW',
  MEDIUM: 'MEDIUM',
  HIGH: 'HIGH',
} as const;

type TicketPriority = typeof TICKET_PRIORITY[keyof typeof TICKET_PRIORITY];
```

**시각적 표현**:

| 우선순위 | 뱃지 색상 | 레이블 |
|----------|----------|--------|
| LOW | 회색 (gray) | 낮음 |
| MEDIUM | 파란색 (blue) | 보통 |
| HIGH | 빨간색 (red) | 높음 |

### 에러 응답 형식

```json
{
  "error": {
    "code": "VALIDATION_ERROR | TICKET_NOT_FOUND | INTERNAL_ERROR",
    "message": "사용자가 읽을 수 있는 한국어 에러 메시지"
  }
}
```

| 에러 코드 | HTTP 상태 | 발생 조건 |
|-----------|----------|----------|
| VALIDATION_ERROR | 400 | 입력값 제약조건 위반 |
| TICKET_NOT_FOUND | 404 | 존재하지 않는 티켓 ID |
| INTERNAL_ERROR | 500 | 서버 내부 오류 |
